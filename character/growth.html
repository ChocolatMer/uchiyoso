<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INVESTIGATOR GROWTH LOG</title>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Shippori+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- data.jsの読み込み -->
    <script src="./data/data.js"></script>

    <style>
        /* --- CORE VARS --- */
        :root {
            --theme-color: #d4b346;
            --bg-color: #0b0b0b;
            --panel-bg: #111;
            --border-color: #333;
            
            /* Skill Categories */
            --cat-combat: #ff6b6b; /* 戦闘 */
            --cat-search: #4ecdc4; /* 探索 */
            --cat-action: #ffe66d; /* 行動 */
            --cat-nego:   #ff9f43; /* 交渉 */
            --cat-know:   #a29bfe; /* 知識 */
            --cat-other:  #aaaaaa; /* その他 */
        }

        /* --- RESET & BASE --- */
        body { 
            background-color: var(--bg-color); 
            background-image: 
                linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20l20 20M20 20L0 40' stroke='%23222' stroke-width='1'/%3E%3C/svg%3E");
            color: #ccc; font-family: 'Shippori Mincho', serif; 
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
        }

        /* --- LAYOUT GRID --- */
        .layout-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 240px 1fr;
            height: 100vh; width: 100%;
        }

        /* 1. SIDEBAR (Left Full Height) */
        .sidebar {
            grid-row: 1 / 3;
            background: rgba(10,10,10,0.95); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; gap: 15px; padding: 20px 15px;
            overflow-y: auto; backdrop-filter: blur(5px); z-index: 20;
        }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb { background: #444; }

        /* 2. TOP AREA (Header & SAN Graph) */
        .top-area {
            grid-column: 2 / 3; grid-row: 1 / 2;
            background: rgba(0,0,0,0.6); border-bottom: 1px solid var(--border-color);
            padding: 15px 25px; display: grid; grid-template-columns: 2fr 1fr; gap: 20px;
        }

        /* 3. MAIN CONTENT (Matrix Table) */
        .main-area {
            grid-column: 2 / 3; grid-row: 2 / 3;
            padding: 0; overflow: hidden; position: relative;
            background: #0e0e0e;
        }

        /* --- COMPONENT: PROFILE --- */
        .app-logo {
            font-family: 'Cinzel'; font-size: 1.1rem; color: var(--theme-color); text-align: center;
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 5px; letter-spacing: 2px;
        }
        .char-card {
            text-align: center; background: #161616; padding: 15px; border-radius: 4px; border: 1px solid #333;
        }
        .char-img {
            width: 80px; height: 80px; border-radius: 50%; object-fit: cover;
            border: 2px solid var(--theme-color); margin-bottom: 10px; background: #000;
        }
        .char-select {
            width: 100%; background: #000; color: #eee; border: 1px solid #444;
            padding: 4px; font-size: 0.8rem; font-family: 'Shippori Mincho';
        }

        /* --- COMPONENT: STATS (Dice Results) --- */
        .stats-box {
            background: rgba(255,255,255,0.02); border: 1px solid #333; border-radius: 4px; padding: 10px;
        }
        .stats-header { font-family: 'Cinzel'; font-size: 0.8rem; color: #888; border-bottom: 1px dashed #333; margin-bottom: 8px; }
        
        .dice-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85rem; }
        .dice-label { color: #aaa; }
        .dice-val { font-family: 'Cinzel'; font-weight: bold; }
        .val-crit { color: #66bb6a; }
        .val-fumb { color: #ff6b6b; }

        /* Skill Ranking */
        .rank-list { list-style: none; padding: 0; margin: 0; font-size: 0.8rem; }
        .rank-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #222; }
        .rank-name { color: #ccc; }
        .rank-count { color: var(--theme-color); font-family: 'Cinzel'; }

        /* --- COMPONENT: SAN CHART & INSANITY --- */
        .chart-wrapper { position: relative; width: 100%; height: 100%; min-height: 180px; }
        .insanity-box { 
            background: rgba(255,20,20,0.05); border: 1px solid #422; padding: 10px; 
            overflow-y: auto; font-size: 0.85rem; border-radius: 4px;
        }
        .insanity-row { margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px dashed #422; }
        .ins-date { font-family: 'Cinzel'; color: #855; font-size: 0.75rem; }
        .ins-title { color: #e88; font-weight: bold; }

        /* --- COMPONENT: MATRIX TABLE --- */
        .matrix-scroll {
            width: 100%; height: 100%; overflow: auto;
            scrollbar-width: thin; scrollbar-color: #444 #111;
        }
        .matrix-scroll::-webkit-scrollbar { width: 10px; height: 10px; }
        .matrix-scroll::-webkit-scrollbar-thumb { background: #444; border: 2px solid #111; }
        .matrix-scroll::-webkit-scrollbar-track { background: #111; }

        table.growth-matrix {
            border-collapse: separate; border-spacing: 0;
            width: 100%; font-size: 0.85rem;
        }

        /* Sticky Headers */
        .growth-matrix thead th {
            position: sticky; top: 0; z-index: 10;
            background: #1a1a1a; color: #aaa; border-bottom: 1px solid #444; border-right: 1px solid #333;
            padding: 5px; font-weight: normal; font-family: 'Cinzel', sans-serif;
            height: 120px; vertical-align: bottom;
        }
        /* Sticky First Columns (Skill Name & Init) */
        .growth-matrix th.sticky-col, .growth-matrix td.sticky-col {
            position: sticky; left: 0; z-index: 11;
            background: #222; border-right: 2px solid #444;
        }
        .growth-matrix th.sticky-col-2, .growth-matrix td.sticky-col-2 {
            position: sticky; left: 160px; z-index: 11; /* Adjust based on col 1 width */
            background: #252525; border-right: 2px solid #444;
        }
        .growth-matrix thead th.sticky-col { z-index: 12; background: #2a2a2a; color: #eee; }
        .growth-matrix thead th.sticky-col-2 { z-index: 12; background: #2a2a2a; }

        /* Table Content */
        .skill-name-cell {
            width: 160px; min-width: 160px; text-align: left; padding: 0 10px;
            border-left: 4px solid transparent; font-weight: bold; color: #ccc;
            display: flex; align-items: center; height: 30px;
        }
        /* Category Colors */
        .cat-combat .skill-name-cell { border-left-color: var(--cat-combat); color: #ffdada; }
        .cat-search .skill-name-cell { border-left-color: var(--cat-search); color: #daffff; }
        .cat-action .skill-name-cell { border-left-color: var(--cat-action); color: #ffffda; }
        .cat-nego   .skill-name-cell { border-left-color: var(--cat-nego);   color: #ffeeda; }
        .cat-know   .skill-name-cell { border-left-color: var(--cat-know);   color: #eaddff; }
        .cat-other  .skill-name-cell { border-left-color: var(--cat-other);  color: #ddd; }

        .init-val-cell {
            width: 50px; min-width: 50px; text-align: center; color: #888;
            font-family: 'Cinzel'; border-bottom: 1px solid #333;
        }

        .growth-val-cell {
            min-width: 40px; text-align: center; border-bottom: 1px solid #333; border-right: 1px solid #333;
            color: #555;
        }
        .growth-val-cell.grown {
            color: #fff; font-weight: bold; background: rgba(212, 179, 70, 0.15);
        }
        .growth-val-cell.highlight {
            background: rgba(255,255,255,0.05);
        }

        /* Vertical Text Header */
        .v-text {
            writing-mode: vertical-rl; transform: rotate(180deg);
            white-space: nowrap; text-align: left; padding: 5px;
            max-height: 110px; margin: 0 auto;
        }

        /* Loading */
        #loadingOverlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--theme-color); font-family: 'Cinzel';
        }

    </style>
</head>
<body>

<div id="loadingOverlay">
    <span class="material-icons-round" style="font-size:3rem; animation:spin 1s linear infinite;">autorenew</span>
    <span id="loadingText" style="margin-top:10px;">CONNECTING...</span>
</div>

<div class="layout-container">
    
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="app-logo">INVESTIGATOR LOG</div>
        
        <!-- Profile -->
        <div class="char-card">
            <img id="charIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="char-img">
            <select id="charSelect" class="char-select">
                <option value="">-- SELECT CHARACTER --</option>
            </select>
            <div id="plName" style="color:#666; font-size:0.7rem; margin-top:5px; font-family:'Cinzel';">PLAYER NAME</div>
        </div>

        <!-- Dice Stats -->
        <div class="stats-box">
            <div class="stats-header">DICE STATISTICS</div>
            <div class="dice-row"><span class="dice-label">TOTAL ROLL</span><span class="dice-val" id="statTotal">0</span></div>
            <div class="dice-row"><span class="dice-label">CRITICAL</span><span class="dice-val val-crit" id="statCrit">0</span></div>
            <div class="dice-row"><span class="dice-label">FUMBLE</span><span class="dice-val val-fumb" id="statFumb">0</span></div>
            <div class="dice-row"><span class="dice-label">SUCCESS RATE</span><span class="dice-val" id="statRate">0%</span></div>
        </div>

        <!-- Skill Ranking -->
        <div class="stats-box" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
            <div class="stats-header">TOP USED SKILLS</div>
            <ul id="rankList" class="rank-list" style="overflow-y:auto; flex:1;">
                <li style="color:#444; text-align:center;">NO DATA</li>
            </ul>
        </div>
    </div>

    <!-- TOP AREA -->
    <div class="top-area">
        <!-- Chart -->
        <div style="position:relative;">
            <div style="position:absolute; top:0; left:0; font-family:'Cinzel'; font-size:0.8rem; color:#888;">SANITY HISTORY</div>
            <div class="chart-wrapper">
                <canvas id="sanChart"></canvas>
            </div>
        </div>
        <!-- Insanity List -->
        <div style="display:flex; flex-direction:column;">
            <div style="font-family:'Cinzel'; font-size:0.8rem; color:#e88; margin-bottom:5px;">INSANITY HISTORY</div>
            <div id="insanityList" class="insanity-box" style="flex:1;">
                <div style="color:#522; text-align:center;">NO RECORD</div>
            </div>
        </div>
    </div>

    <!-- MAIN AREA (MATRIX) -->
    <div class="main-area">
        <div class="matrix-scroll">
            <table class="growth-matrix" id="matrixTable">
                <thead>
                    <tr>
                        <th class="sticky-col">SKILL NAME</th>
                        <th class="sticky-col-2">INIT</th>
                        <!-- Scenarios here -->
                        <th>TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows here -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<style> @keyframes spin { 100% { transform: rotate(360deg); } } </style>

<script type="module">
    import { loadFromCloud, monitorAuth, getScenariosForCharacter } from "./firestore.js";

    // 1. SKILL DEFINITIONS (Fallback if data.js missing)
    const BASE_SKILLS_DEF = (typeof window.BASE_SKILLS !== 'undefined') ? window.BASE_SKILLS : {
        "目星": 25, "聞き耳": 25, "図書館": 25, "回避": "DEX*2", "こぶし（パンチ）": 50
    };

    // Skill Categories
    const SKILL_CATS = {
        combat: ["回避", "キック", "組み付き", "こぶし", "パンチ", "頭突き", "投擲", "マーシャルアーツ", "拳銃", "サブマシンガン", "ショットガン", "マシンガン", "ライフル", "日本刀", "ナイフ"],
        search: ["応急手当", "鍵開け", "隠す", "隠れる", "聞き耳", "忍び歩き", "写真術", "精神分析", "追跡", "登攀", "図書館", "目星"],
        action: ["運転", "機械修理", "重機械操作", "乗馬", "水泳", "製作", "操縦", "跳躍", "電気修理", "ナビゲート", "変装"],
        nego:   ["言いくるめ", "信用", "説得", "値切り", "母国語"],
        know:   ["医学", "オカルト", "化学", "クトゥルフ神話", "芸術", "経理", "考古学", "コンピューター", "心理学", "人類学", "生物学", "地質学", "電子工学", "天文学", "博物学", "物理学", "法律", "薬学", "歴史"]
    };

    let allChars = {};
    let sanChart = null;
    const el = (id) => document.getElementById(id);

    // --- INITIALIZATION ---
    window.onload = () => {
        monitorAuth(async (user) => {
            el('loadingText').textContent = "LOADING DATA...";
            try {
                allChars = await loadFromCloud();
                renderCharSelect();
                el('loadingOverlay').style.display = 'none';
            } catch(e) {
                console.error(e);
                el('loadingText').textContent = "DATA LOAD ERROR";
            }
        }, () => {
            el('loadingText').textContent = "PLEASE LOGIN";
        });
    };

    function renderCharSelect() {
        const sel = el('charSelect');
        sel.innerHTML = '<option value="">-- SELECT --</option>';
        Object.values(allChars)
            .sort((a,b) => (a.name||"").localeCompare(b.name||""))
            .forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.name;
                sel.appendChild(opt);
            });
        
        sel.addEventListener('change', (e) => {
            if(e.target.value) loadCharacter(e.target.value);
        });
    }

    // --- MAIN LOADING LOGIC ---
    async function loadCharacter(charId) {
        el('loadingOverlay').style.display = 'flex';
        const char = allChars[charId];
        
        // 1. Setup Profile & Theme
        const color = char.color || '#d4b346';
        document.documentElement.style.setProperty('--theme-color', color);
        el('charIcon').style.borderColor = color;
        el('charIcon').src = char.icon || `../images/icon/${char.name}.png`;
        el('plName').textContent = "PL: " + (char.plName || "Unknown");

        // 2. Fetch Scenarios
        const scenarios = await getScenariosForCharacter(charId);
        // Sort: Oldest -> Newest
        const sortedScenarios = scenarios.sort((a,b) => new Date(a.date||0) - new Date(b.date||0));

        // 3. Process Data
        const stats = processStats(char, sortedScenarios);
        const matrix = processMatrix(char, sortedScenarios);

        // 4. Render
        renderStats(stats);
        renderSanChart(stats.sanHistory);
        renderInsanity(stats.insanityHistory);
        renderMatrix(matrix, sortedScenarios);

        el('loadingOverlay').style.display = 'none';
    }

    // --- DATA PROCESSING ---

    // Stats (Dice & SAN)
    function processStats(char, scenarios) {
        let dice = { total:0, crit:0, fumb:0, succ:0 };
        let skillCounts = {};
        let sanHistory = [];
        let insanityHistory = [];

        // Initial SAN (from Char Data if available)
        let initialSan = char.vitals?.san || char.stats?.POW*5 || 50;
        sanHistory.push({ label: 'START', value: initialSan });

        scenarios.forEach(s => {
            // Find role data
            let d = (s.characters.pc?.id === char.id) ? s.characters.pc : 
                    (s.characters.kpc?.id === char.id) ? s.characters.kpc : null;
            
            if(!d) return;

            // 1. Log Analysis (Dice Stats)
            if (s.analysisData && s.analysisData[char.name]) {
                const ana = s.analysisData[char.name];
                dice.total += ana.dice || 0;
                dice.crit += ana.crit || 0;
                dice.fumb += ana.fumb || 0;
                dice.succ += (ana.succ || 0);
                
                // Skill Usage Ranking
                if (ana.skillDetails) {
                    Object.entries(ana.skillDetails).forEach(([skill, detail]) => {
                        skillCounts[skill] = (skillCounts[skill] || 0) + detail.count;
                    });
                }
            }

            // 2. SAN History
            if (d.san) {
                // Try parse "50 -> 45"
                let sanVal = null;
                const m = d.san.match(/.*[→>＞]\s*(\d+)/);
                if (m) sanVal = parseInt(m[1]);
                else if (!isNaN(parseInt(d.san))) sanVal = parseInt(d.san);
                
                if (sanVal !== null) sanHistory.push({ label: s.title, value: sanVal });
            }

            // 3. Insanity
            if (d.ins && d.ins.type) {
                insanityHistory.push({ date: s.date, title: s.title, desc: d.ins.desc });
            }
        });

        return { dice, skillCounts, sanHistory, insanityHistory };
    }

    // Matrix (Skill Growth)
    function processMatrix(char, scenarios) {
        // 1. Identify Initial Values from Char Data Text
        const userInitials = {};
        if (char.skillList) {
            // "目星:70" etc.
            const lines = char.skillList.split(/[\n\s,、]+/);
            lines.forEach(l => {
                const m = l.match(/^(.+?)[:：\s]*(\d+)$/);
                if(m) userInitials[m[1].trim()] = parseInt(m[2]);
            });
        }

        // 2. Collect ALL Skills (Base + User + Growth)
        const allSkillNames = new Set(Object.keys(BASE_SKILLS_DEF));
        Object.keys(userInitials).forEach(k => allSkillNames.add(k));

        // 3. Collect Growth per Scenario
        const scenarioGrowths = scenarios.map(s => {
            const growths = {};
            let d = (s.characters.pc?.id === char.id) ? s.characters.pc : 
                    (s.characters.kpc?.id === char.id) ? s.characters.kpc : null;
            
            if(d && d.grow) {
                d.grow.split('\n').forEach(l => {
                    const m = l.match(/(.+?)\s*[:：]?\s*\+?(\d+)/);
                    if(m) {
                        const name = m[1].trim();
                        const val = parseInt(m[2]);
                        growths[name] = (growths[name]||0) + val;
                        allSkillNames.add(name); // Add found skill
                    }
                });
            }
            return { id: s.id, growths };
        });

        // 4. Build Rows
        const rows = [];
        Array.from(allSkillNames).sort().forEach(name => {
            // Initial Calculation
            let init = 0;
            if (userInitials[name] !== undefined) {
                init = userInitials[name];
            } else {
                const def = BASE_SKILLS_DEF[name];
                if (typeof def === 'number') init = def;
                else if (def === 'DEX*2') init = (char.stats?.DEX || 10) * 2;
                else if (def === 'EDU*5') init = (char.stats?.EDU || 10) * 5;
            }

            // Category
            let cat = 'other';
            for(const [k, v] of Object.entries(SKILL_CATS)) {
                if(v.some(s => name.includes(s))) { cat = k; break; }
            }

            // History
            let current = init;
            const history = scenarioGrowths.map(sg => {
                const g = sg.growths[name] || 0;
                current += g;
                return { val: current, grow: g };
            });

            rows.push({ name, cat, init, history, current });
        });

        // Sort rows by Category then Name
        const catOrder = ['combat', 'search', 'action', 'nego', 'know', 'other'];
        rows.sort((a,b) => {
            const ciA = catOrder.indexOf(a.cat);
            const ciB = catOrder.indexOf(b.cat);
            if(ciA !== ciB) return ciA - ciB;
            return a.name.localeCompare(b.name);
        });

        return rows;
    }

    // --- RENDERING ---

    function renderStats(stats) {
        // Dice
        const d = stats.dice;
        el('statTotal').textContent = d.total;
        el('statCrit').textContent = d.crit;
        el('statFumb').textContent = d.fumb;
        const rate = d.total > 0 ? Math.round(((d.succ + d.crit)/d.total)*100) : 0;
        el('statRate').textContent = rate + "%";

        // Ranking
        const list = el('rankList');
        list.innerHTML = "";
        const sorted = Object.entries(stats.skillCounts).sort((a,b) => b[1]-a[1]).slice(0, 10);
        if(sorted.length === 0) {
            list.innerHTML = '<li style="text-align:center; color:#444;">NO DATA</li>';
        } else {
            sorted.forEach(([name, count]) => {
                list.innerHTML += `
                    <li class="rank-item">
                        <span class="rank-name">${name}</span>
                        <span class="rank-count">${count}</span>
                    </li>`;
            });
        }
    }

    function renderSanChart(history) {
        const ctx = el('sanChart').getContext('2d');
        if(sanChart) sanChart.destroy();

        const labels = history.map((_, i) => i===0 ? 'Start' : `#${i}`);
        const data = history.map(h => h.value);
        const titles = history.map(h => h.label);

        sanChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'SAN', data: data,
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--theme-color').trim(),
                    backgroundColor: 'rgba(255,255,255,0.05)',
                    borderWidth: 2, tension: 0.1, pointRadius: 3, fill: true
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { title: (c) => titles[c[0].dataIndex] } }
                },
                scales: {
                    x: { display: false },
                    y: { grid: { color: '#333' }, ticks: { color: '#666' }, suggestedMin: 0, suggestedMax: 99 }
                }
            }
        });
    }

    function renderInsanity(history) {
        const box = el('insanityList');
        box.innerHTML = "";
        if(history.length === 0) {
            box.innerHTML = '<div style="color:#522; text-align:center;">NO RECORD</div>';
            return;
        }
        // Reverse order (newest first)
        [...history].reverse().forEach(h => {
            box.innerHTML += `
                <div class="insanity-row">
                    <div class="ins-date">${h.date || '----'} / ${h.title}</div>
                    <div class="ins-title">${h.desc}</div>
                </div>`;
        });
    }

    function renderMatrix(rows, scenarios) {
        const table = el('matrixTable');
        const theadTr = table.querySelector('thead tr');
        const tbody = table.querySelector('tbody');

        // Clear existing scenario headers
        // Keep first 2 columns (Skill, Init)
        while(theadTr.children.length > 2) theadTr.removeChild(theadTr.lastChild);
        
        // Add Scenario Headers
        scenarios.forEach(s => {
            const th = document.createElement('th');
            // Shorten title
            let t = s.title;
            if(t.length > 8) t = t.substring(0,8) + '..';
            th.innerHTML = `<div class="v-text" title="${s.title}">${t}</div>`;
            theadTr.appendChild(th);
        });
        
        // Add Total Header
        const thTotal = document.createElement('th');
        thTotal.textContent = "TOTAL";
        theadTr.appendChild(thTotal);

        // Render Body
        tbody.innerHTML = "";
        rows.forEach(row => {
            const tr = document.createElement('tr');
            tr.className = `cat-${row.cat}`;

            // Name
            const tdName = document.createElement('td');
            tdName.className = "sticky-col skill-name-cell";
            tdName.textContent = row.name;
            tr.appendChild(tdName);

            // Init
            const tdInit = document.createElement('td');
            tdInit.className = "sticky-col-2 init-val-cell";
            tdInit.textContent = row.init;
            tr.appendChild(tdInit);

            // History
            row.history.forEach(h => {
                const td = document.createElement('td');
                td.className = "growth-val-cell";
                td.textContent = h.val;
                if(h.grow > 0) {
                    td.classList.add('grown');
                    td.title = `+${h.grow}`;
                }
                tr.appendChild(td);
            });

            // Total
            const tdTotal = document.createElement('td');
            tdTotal.className = "growth-val-cell";
            tdTotal.style.color = "#d4b346";
            tdTotal.style.fontWeight = "bold";
            tdTotal.textContent = row.current;
            tr.appendChild(tdTotal);

            tbody.appendChild(tr);
        });
    }

</script>
</body>
</html>
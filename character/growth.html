<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INVESTIGATOR GROWTH LOG</title>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Shippori+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="./data/data.js"></script>

    <style>
        /* --- CORE VARS --- */
        :root {
            --theme-color: #d4b346;
            --bg-color: #0b0b0b;
            --panel-bg: #111;
            --border-color: #333;
            
            /* Skill Categories */
            --cat-combat: #ff6b6b;
            --cat-search: #4ecdc4;
            --cat-action: #ffe66d;
            --cat-nego:   #ff9f43;
            --cat-know:   #a29bfe;
            --cat-other:  #888;
        }

        /* --- BASE --- */
        body { 
            background-color: var(--bg-color); 
            background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='1' cy='1' r='1' fill='%23222'/%3E%3C/svg%3E");
            color: #ccc; font-family: 'Shippori Mincho', serif; 
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
        }

        /* --- LAYOUT --- */
        .layout-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 200px 1fr;
            height: 100vh; width: 100%;
        }

        /* SIDEBAR */
        .sidebar {
            grid-row: 1 / 3;
            background: rgba(10,10,10,0.98); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; gap: 15px; padding: 15px;
            overflow-y: auto; z-index: 20;
        }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb { background: #444; }

        /* TOP AREA */
        .top-area {
            grid-column: 2 / 3; grid-row: 1 / 2;
            background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border-color);
            padding: 10px 20px; display: grid; grid-template-columns: 2fr 1fr; gap: 20px;
        }

        /* MAIN CONTENT */
        .main-area {
            grid-column: 2 / 3; grid-row: 2 / 3;
            padding: 0; overflow: hidden; position: relative;
            background: #0e0e0e;
        }

        /* --- COMPONENTS --- */
        .app-logo {
            font-family: 'Cinzel'; font-size: 1.1rem; color: var(--theme-color); text-align: center;
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 5px; letter-spacing: 2px;
        }
        .char-card {
            text-align: center; background: #161616; padding: 10px; border-radius: 4px; border: 1px solid #333;
        }
        .char-img {
            width: 70px; height: 70px; border-radius: 50%; object-fit: cover;
            border: 2px solid var(--theme-color); margin-bottom: 5px; background: #000;
        }
        .char-select {
            width: 100%; background: #000; color: #eee; border: 1px solid #444;
            padding: 4px; font-size: 0.8rem; font-family: 'Shippori Mincho';
        }

        /* Stats Box */
        .stats-box {
            background: rgba(255,255,255,0.02); border: 1px solid #333; border-radius: 4px; padding: 10px;
        }
        .stats-header { font-family: 'Cinzel'; font-size: 0.75rem; color: #888; border-bottom: 1px dashed #333; margin-bottom: 6px; }
        .dice-row { display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 0.8rem; }
        .dice-val { font-family: 'Cinzel'; font-weight: bold; }
        .val-crit { color: #66bb6a; }
        .val-fumb { color: #ff6b6b; }

        .rank-list { list-style: none; padding: 0; margin: 0; font-size: 0.75rem; }
        .rank-item { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid #222; }
        .rank-count { color: var(--theme-color); font-family: 'Cinzel'; }

        /* Chart & Insanity */
        .chart-wrapper { position: relative; width: 100%; height: 100%; min-height: 160px; }
        .insanity-box { 
            background: rgba(255,20,20,0.03); border: 1px solid #333; padding: 8px; 
            overflow-y: auto; font-size: 0.8rem; border-radius: 4px; height: 160px;
        }
        .insanity-row { margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px dashed #422; }
        .ins-date { font-family: 'Cinzel'; color: #855; font-size: 0.7rem; }
        .ins-title { color: #d88; }

        /* --- MATRIX TABLE --- */
        .matrix-scroll {
            width: 100%; height: 100%; overflow: auto;
            /* Scrollbar styling */
            scrollbar-width: thin; scrollbar-color: #555 #111;
        }
        .matrix-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
        .matrix-scroll::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
        .matrix-scroll::-webkit-scrollbar-track { background: #111; }

        table.growth-matrix {
            border-collapse: separate; border-spacing: 0;
            width: max-content; /* Fit content exactly */
            font-size: 0.8rem;
            background: #0e0e0e;
        }

        /* Headers */
        .growth-matrix thead th {
            position: sticky; top: 0; z-index: 10;
            background: #111; color: #aaa; 
            border-bottom: 1px solid #444; border-right: 1px solid #222;
            padding: 4px; font-weight: normal; font-family: 'Cinzel', sans-serif;
            height: 100px; vertical-align: bottom;
        }

        /* Sticky Columns (SKILL & INIT) */
        .growth-matrix th.sticky-col, .growth-matrix td.sticky-col {
            position: sticky; left: 0; z-index: 11;
            background: #161616; border-right: 1px solid #444;
        }
        .growth-matrix th.sticky-col-2, .growth-matrix td.sticky-col-2 {
            position: sticky; left: 140px; z-index: 11; /* Width of Col 1 */
            background: #1a1a1a; border-right: 2px solid #555;
        }
        /* Header specifics */
        .growth-matrix thead th.sticky-col { z-index: 12; background: #222; color: #fff; border-bottom: 2px solid #555; }
        .growth-matrix thead th.sticky-col-2 { z-index: 12; background: #222; color: #d4b346; border-bottom: 2px solid #555; }

        /* Cells */
        .skill-name-cell {
            width: 140px; max-width: 140px; /* Limit width */
            text-align: left; padding: 4px 8px;
            border-left: 3px solid transparent; font-weight: normal; color: #ccc;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            border-bottom: 1px solid #222;
        }
        .init-val-cell {
            width: 40px; text-align: center; color: #d4b346; font-weight: bold;
            font-family: 'Cinzel'; border-bottom: 1px solid #222;
        }
        .growth-val-cell {
            min-width: 30px; text-align: center; border-bottom: 1px solid #222; border-right: 1px solid #222;
            color: #444;
        }
        
        /* Category Colors */
        .cat-combat .skill-name-cell { border-left-color: var(--cat-combat); }
        .cat-search .skill-name-cell { border-left-color: var(--cat-search); }
        .cat-action .skill-name-cell { border-left-color: var(--cat-action); }
        .cat-nego   .skill-name-cell { border-left-color: var(--cat-nego); }
        .cat-know   .skill-name-cell { border-left-color: var(--cat-know); }
        .cat-other  .skill-name-cell { border-left-color: var(--cat-other); }

        /* Row Stripes */
        .growth-matrix tbody tr:nth-child(even) td:not(.sticky-col):not(.sticky-col-2) { background: rgba(255,255,255,0.02); }
        .growth-matrix tbody tr:hover td { background: rgba(255,255,255,0.05); color: #fff; }

        /* Highlight Growth */
        .growth-val-cell.grown {
            color: #fff; font-weight: bold; background: rgba(212, 179, 70, 0.2) !important;
        }
        /* Highlight Total */
        .growth-val-cell.total-col {
            color: #d4b346; font-weight: bold; border-left: 1px solid #444;
        }

        /* Vertical Header Text */
        .v-text {
            writing-mode: vertical-rl; transform: rotate(180deg);
            white-space: nowrap; text-align: left; padding: 4px 2px;
            max-height: 90px; margin: 0 auto; font-size: 0.75rem;
        }

        #loadingOverlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--theme-color); font-family: 'Cinzel';
        }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <span class="material-icons-round" style="font-size:3rem; animation:spin 1s linear infinite;">autorenew</span>
    <span id="loadingText" style="margin-top:10px;">CONNECTING...</span>
</div>

<div class="layout-container">
    
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="app-logo">INVESTIGATOR LOG</div>
        
        <!-- Profile -->
        <div class="char-card">
            <img id="charIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="char-img">
            <select id="charSelect" class="char-select">
                <option value="">-- SELECT CHARACTER --</option>
            </select>
            <div id="plName" style="color:#666; font-size:0.7rem; margin-top:5px; font-family:'Cinzel';">PLAYER NAME</div>
        </div>

        <!-- Dice Stats -->
        <div class="stats-box">
            <div class="stats-header">DICE STATISTICS</div>
            <div class="dice-row"><span class="dice-label">TOTAL ROLL</span><span class="dice-val" id="statTotal">0</span></div>
            <div class="dice-row"><span class="dice-label">CRITICAL</span><span class="dice-val val-crit" id="statCrit">0</span></div>
            <div class="dice-row"><span class="dice-label">FUMBLE</span><span class="dice-val val-fumb" id="statFumb">0</span></div>
            <div class="dice-row"><span class="dice-label">SUCCESS RATE</span><span class="dice-val" id="statRate">0%</span></div>
        </div>

        <!-- Skill Ranking -->
        <div class="stats-box" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
            <div class="stats-header">TOP USED SKILLS</div>
            <ul id="rankList" class="rank-list" style="overflow-y:auto; flex:1;">
                <li style="color:#444; text-align:center;">NO DATA</li>
            </ul>
        </div>
    </div>

    <!-- TOP AREA -->
    <div class="top-area">
        <!-- Chart -->
        <div style="position:relative;">
            <div style="position:absolute; top:0; left:0; font-family:'Cinzel'; font-size:0.8rem; color:#888;">SANITY HISTORY</div>
            <div class="chart-wrapper">
                <canvas id="sanChart"></canvas>
            </div>
        </div>
        <!-- Insanity List -->
        <div style="display:flex; flex-direction:column;">
            <div style="font-family:'Cinzel'; font-size:0.8rem; color:#e88; margin-bottom:5px;">INSANITY HISTORY</div>
            <div id="insanityList" class="insanity-box">
                <div style="color:#522; text-align:center;">NO RECORD</div>
            </div>
        </div>
    </div>

    <!-- MAIN AREA (MATRIX) -->
    <div class="main-area">
        <div class="matrix-scroll">
            <table class="growth-matrix" id="matrixTable">
                <thead>
                    <tr>
                        <th class="sticky-col">SKILL</th>
                        <th class="sticky-col-2">INIT</th>
                        <!-- Scenarios appended here -->
                        <th>TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows appended here -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<style> @keyframes spin { 100% { transform: rotate(360deg); } } </style>

<script type="module">
    import { loadFromCloud, monitorAuth, getScenariosForCharacter } from "./firestore.js";

    // data.js の BASE_SKILLS を安全に取得 (フォールバック定義)
    const BASE_SKILLS_DEF = (typeof window.BASE_SKILLS !== 'undefined') ? window.BASE_SKILLS : {
        "目星": 25, "聞き耳": 25, "図書館": 25, "回避": "DEX*2", "こぶし（パンチ）": 50,
        "応急手当": 30, "隠れる": 10, "忍び歩き": 10, "追跡": 10, "登攀": 40
    };

    // Skill Categories
    const SKILL_CATS = {
        combat: ["回避", "キック", "組み付き", "こぶし", "パンチ", "頭突き", "投擲", "マーシャルアーツ", "拳銃", "サブマシンガン", "ショットガン", "マシンガン", "ライフル", "日本刀", "ナイフ"],
        search: ["応急手当", "鍵開け", "隠す", "隠れる", "聞き耳", "忍び歩き", "写真術", "精神分析", "追跡", "登攀", "図書館", "目星"],
        action: ["運転", "機械修理", "重機械操作", "乗馬", "水泳", "製作", "操縦", "跳躍", "電気修理", "ナビゲート", "変装"],
        nego:   ["言いくるめ", "信用", "説得", "値切り", "母国語"],
        know:   ["医学", "オカルト", "化学", "クトゥルフ神話", "芸術", "経理", "考古学", "コンピューター", "心理学", "人類学", "生物学", "地質学", "電子工学", "天文学", "博物学", "物理学", "法律", "薬学", "歴史"]
    };

    let allChars = {};
    let sanChart = null;
    const el = (id) => document.getElementById(id);

    // --- INITIALIZATION ---
    window.onload = () => {
        monitorAuth(async (user) => {
            el('loadingText').textContent = "LOADING DATA...";
            try {
                allChars = await loadFromCloud();
                renderCharSelect();
                el('loadingOverlay').style.display = 'none';
            } catch(e) {
                console.error(e);
                el('loadingText').textContent = "DATA LOAD ERROR";
            }
        }, () => {
            el('loadingText').textContent = "PLEASE LOGIN";
        });
    };

    function renderCharSelect() {
        const sel = el('charSelect');
        sel.innerHTML = '<option value="">-- SELECT --</option>';
        Object.values(allChars)
            .sort((a,b) => (a.name||"").localeCompare(b.name||""))
            .forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.name;
                sel.appendChild(opt);
            });
        
        sel.addEventListener('change', (e) => {
            if(e.target.value) loadCharacter(e.target.value);
        });
    }

    // --- MAIN LOADING LOGIC ---
    async function loadCharacter(charId) {
        el('loadingOverlay').style.display = 'flex';
        const char = allChars[charId];
        
        // Setup Theme
        const color = char.color || '#d4b346';
        document.documentElement.style.setProperty('--theme-color', color);
        el('charIcon').style.borderColor = color;
        el('charIcon').src = char.icon || `../images/icon/${char.name}.png`;
        el('plName').textContent = "PL: " + (char.plName || "Unknown");

        // Fetch Scenarios
        const scenarios = await getScenariosForCharacter(charId);
        
        // Sort: Count (Asc) -> Date (Asc)
        const sortedScenarios = scenarios.sort((a,b) => {
            const countA = parseInt(a.count) || 999;
            const countB = parseInt(b.count) || 999;
            if(countA !== countB) return countA - countB;
            return new Date(a.date||0) - new Date(b.date||0);
        });

        // Process & Render
        const stats = processStats(char, sortedScenarios);
        const matrix = processMatrix(char, sortedScenarios);

        renderStats(stats);
        renderSanChart(stats.sanHistory);
        renderInsanity(stats.insanityHistory);
        renderMatrix(matrix, sortedScenarios);

        el('loadingOverlay').style.display = 'none';
    }

    // --- DATA PROCESSING ---

    function processStats(char, scenarios) {
        let dice = { total:0, crit:0, fumb:0, succ:0 };
        let skillCounts = {};
        let sanHistory = [];
        let insanityHistory = [];

        let initialSan = char.vitals?.san || char.stats?.POW*5 || 50;
        sanHistory.push({ label: 'START', value: initialSan });

        scenarios.forEach(s => {
            let d = (s.characters.pc?.id === char.id) ? s.characters.pc : 
                    (s.characters.kpc?.id === char.id) ? s.characters.kpc : null;
            if(!d) return;

            if (s.analysisData && s.analysisData[char.name]) {
                const ana = s.analysisData[char.name];
                dice.total += ana.dice || 0;
                dice.crit += ana.crit || 0;
                dice.fumb += ana.fumb || 0;
                dice.succ += (ana.succ || 0);
                if (ana.skillDetails) {
                    Object.entries(ana.skillDetails).forEach(([skill, detail]) => {
                        skillCounts[skill] = (skillCounts[skill] || 0) + detail.count;
                    });
                }
            }

            if (d.san) {
                let sanVal = null;
                const m = d.san.match(/.*[→>＞]\s*(\d+)/);
                if (m) sanVal = parseInt(m[1]);
                else if (!isNaN(parseInt(d.san))) sanVal = parseInt(d.san);
                if (sanVal !== null) sanHistory.push({ label: s.title, value: sanVal });
            }

            if (d.ins && d.ins.type) {
                insanityHistory.push({ date: s.date, title: s.title, desc: d.ins.desc });
            }
        });

        return { dice, skillCounts, sanHistory, insanityHistory };
    }

    function processMatrix(char, scenarios) {
        // --- 1. キャラクター保存データから技能一覧と初期値を抽出 ---
        // char.skills に構造化されたデータがあればそれを使用
        // (edit.htmlで保存されたデータ: skills.combat[{name, init, job, interest, growth...}])
        
        const skillBaseMap = {}; // { 技能名: {init, job, interest, etc.} }

        if (char.skills && typeof char.skills === 'object') {
            Object.values(char.skills).flat().forEach(s => {
                if(s.name) {
                    // 初期値 = 初期 + 職業 + 興味 + (edit画面での成長分があれば除くか含めるかはお好みだが、"シナリオ成長"とは分けるため、ここでは一旦含める)
                    // ただし、シナリオ成長はこの後の処理で加算するため、ここでは「開始時点のベース」として扱う
                    const base = (parseInt(s.init)||0) + (parseInt(s.job)||0) + (parseInt(s.interest)||0) + (parseInt(s.growth)||0); 
                    skillBaseMap[s.name] = base;
                }
            });
        } 
        // 構造データがない場合 (古いテキスト形式 skillList)
        else if (char.skillList) {
            const lines = char.skillList.split(/[\n\s,、]+/);
            lines.forEach(l => {
                const m = l.match(/^(.+?)[:：\s]*(\d+)$/);
                if(m) skillBaseMap[m[1].trim()] = parseInt(m[2]);
            });
        }

        // --- 2. シナリオごとの成長データを収集 ---
        // (前回と同じロジック)
        const scenarioGrowths = scenarios.map(s => {
            const growths = {};
            let d = (s.characters.pc?.id === char.id) ? s.characters.pc : 
                    (s.characters.kpc?.id === char.id) ? s.characters.kpc : null;
            
            if(d && d.grow) {
                d.grow.split('\n').forEach(l => {
                    const m = l.match(/(.+?)\s*[:：]?\s*\+?(\d+)/);
                    if(m) {
                        const name = m[1].trim();
                        const val = parseInt(m[2]);
                        growths[name] = (growths[name]||0) + val;
                        // もしキャラシにない技能が成長していたら追加
                        if (skillBaseMap[name] === undefined) {
                            skillBaseMap[name] = 0; // 初期値不明なら0スタート
                        }
                    }
                });
            }
            return { id: s.id, growths };
        });

        // --- 3. 行データ生成 ---
        const rows = [];
        Object.keys(skillBaseMap).sort().forEach(name => {
            // 初期値 (キャラシの値)
            let baseVal = skillBaseMap[name];
            
            // カテゴリ判定
            let cat = 'other';
            for(const [k, v] of Object.entries(SKILL_CATS)) {
                if(v.some(s => name.includes(s))) { cat = k; break; }
            }

            // 履歴生成
            let current = baseVal;
            const history = scenarioGrowths.map(sg => {
                const g = sg.growths[name] || 0;
                current += g;
                return { val: current, grow: g };
            });

            rows.push({ name, cat, init: baseVal, history, current });
        });

        // カテゴリ順ソート
        const catOrder = ['combat', 'search', 'action', 'nego', 'know', 'other'];
        rows.sort((a,b) => {
            const ciA = catOrder.indexOf(a.cat);
            const ciB = catOrder.indexOf(b.cat);
            if(ciA !== ciB) return ciA - ciB;
            return a.name.localeCompare(b.name);
        });

        return rows;
    }

    // --- RENDERING ---

    function renderStats(stats) {
        const d = stats.dice;
        el('statTotal').textContent = d.total;
        el('statCrit').textContent = d.crit;
        el('statFumb').textContent = d.fumb;
        const rate = d.total > 0 ? Math.round(((d.succ + d.crit)/d.total)*100) : 0;
        el('statRate').textContent = rate + "%";

        const list = el('rankList');
        list.innerHTML = "";
        const sorted = Object.entries(stats.skillCounts).sort((a,b) => b[1]-a[1]).slice(0, 10);
        if(sorted.length === 0) list.innerHTML = '<li style="text-align:center; color:#444;">NO DATA</li>';
        else sorted.forEach(([n, c]) => list.innerHTML += `<li class="rank-item"><span class="rank-name">${n}</span><span class="rank-count">${c}</span></li>`);
    }

    function renderSanChart(history) {
        const ctx = el('sanChart').getContext('2d');
        if(sanChart) sanChart.destroy();
        const labels = history.map((_, i) => i===0 ? 'Start' : `#${i}`);
        const data = history.map(h => h.value);
        const titles = history.map(h => h.label);

        sanChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'SAN', data: data,
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--theme-color').trim(),
                    backgroundColor: 'rgba(255,255,255,0.05)',
                    borderWidth: 2, tension: 0.1, pointRadius: 3, fill: true
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { callbacks: { title: (c) => titles[c[0].dataIndex] } } },
                scales: { x: { display: false }, y: { grid: { color: '#333' }, ticks: { color: '#666' }, suggestedMin: 0, suggestedMax: 99 } }
            }
        });
    }

    function renderInsanity(history) {
        const box = el('insanityList');
        box.innerHTML = "";
        if(history.length === 0) { box.innerHTML = '<div style="color:#522; text-align:center;">NO RECORD</div>'; return; }
        [...history].reverse().forEach(h => {
            box.innerHTML += `<div class="insanity-row"><div class="ins-date">${h.date || ''} / ${h.title}</div><div class="ins-title">${h.desc}</div></div>`;
        });
    }

    function renderMatrix(rows, scenarios) {
        const table = el('matrixTable');
        const theadTr = table.querySelector('thead tr');
        const tbody = table.querySelector('tbody');

        // Reset Header
        while(theadTr.children.length > 2) theadTr.removeChild(theadTr.lastChild);
        scenarios.forEach(s => {
            const th = document.createElement('th');
            let t = s.title;
            if(t.length > 6) t = t.substring(0,6) + '..';
            th.innerHTML = `<div class="v-text" title="${s.title}">${t}</div>`;
            theadTr.appendChild(th);
        });
        const thTotal = document.createElement('th');
        thTotal.innerHTML = `<div class="v-text">TOTAL</div>`;
        theadTr.appendChild(thTotal);

        // Body
        tbody.innerHTML = "";
        rows.forEach(row => {
            const tr = document.createElement('tr');
            tr.className = `cat-${row.cat}`;

            const tdName = document.createElement('td');
            tdName.className = "sticky-col skill-name-cell";
            tdName.textContent = row.name;
            tr.appendChild(tdName);

            const tdInit = document.createElement('td');
            tdInit.className = "sticky-col-2 init-val-cell";
            tdInit.textContent = row.init;
            tr.appendChild(tdInit);

            row.history.forEach(h => {
                const td = document.createElement('td');
                td.className = "growth-val-cell";
                td.textContent = h.val;
                if(h.grow > 0) {
                    td.classList.add('grown');
                    td.title = `+${h.grow}`;
                }
                tr.appendChild(td);
            });

            const tdTotal = document.createElement('td');
            tdTotal.className = "growth-val-cell total-col";
            tdTotal.textContent = row.current;
            tr.appendChild(tdTotal);

            tbody.appendChild(tr);
        });
    }
</script>
</body>
</html>